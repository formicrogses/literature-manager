<!DOCTYPE html>
<html>
<head>
    <title>ä¸»åº”ç”¨åŒæ­¥çŠ¶æ€æ£€æŸ¥</title>
    <script src="config.js"></script>
    <script src="github-sync.js"></script>
    <script src="indexeddb-storage.js"></script>
    <script src="app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .ok { background: #d4edda; }
        .warn { background: #fff3cd; }
        .error { background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; }
        input { padding: 8px; width: 200px; }
    </style>
</head>
<body>
    <h1>ğŸ” ä¸»åº”ç”¨GitHubåŒæ­¥çŠ¶æ€æ£€æŸ¥</h1>
    
    <div>
        <h3>å¿«é€Ÿé…ç½®</h3>
        <p>Token: <input type="password" id="token" placeholder="è¾“å…¥GitHub Token"></p>
        <button onclick="quickSetup()">å¿«é€Ÿé…ç½®</button>
    </div>
    
    <div>
        <h3>çŠ¶æ€æ£€æŸ¥</h3>
        <button onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
        <div id="statusResult"></div>
    </div>
    
    <div>
        <h3>æ¨¡æ‹Ÿä¸Šä¼ </h3>
        <button onclick="simulateUpload()">æ¨¡æ‹Ÿè®ºæ–‡ä¸Šä¼ </button>
        <div id="uploadResult"></div>
    </div>
    
    <script>
    let literatureManager = null;
    
    function log(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        const div = document.createElement('div');
        div.className = `status ${type}`;
        div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
        element.appendChild(div);
    }
    
    function clear(elementId) {
        document.getElementById(elementId).innerHTML = '';
    }
    
    async function quickSetup() {
        const token = document.getElementById('token').value;
        if (!token) {
            alert('è¯·è¾“å…¥Token');
            return;
        }
        
        // è®¾ç½®é…ç½®
        window.GITHUB_CONFIG.token = token;
        localStorage.setItem('github_token', token);
        localStorage.setItem('github_username', 'wazgtam1');
        
        // åˆå§‹åŒ–githubSync
        if (typeof GitHubSync !== 'undefined') {
            window.githubSync = new GitHubSync();
        }
        
        alert('é…ç½®å®Œæˆï¼');
    }
    
    async function checkStatus() {
        clear('statusResult');
        
        // æ£€æŸ¥åŸºæœ¬é…ç½®
        log('statusResult', `GITHUB_CONFIG.username: ${window.GITHUB_CONFIG.username}`, 'info');
        log('statusResult', `GITHUB_CONFIG.token: ${window.GITHUB_CONFIG.token ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}`, window.GITHUB_CONFIG.token ? 'ok' : 'error');
        
        // æ£€æŸ¥localStorage
        const savedToken = localStorage.getItem('github_token');
        log('statusResult', `localStorage token: ${savedToken ? 'å·²ä¿å­˜' : 'æœªä¿å­˜'}`, savedToken ? 'ok' : 'warn');
        
        // æ£€æŸ¥GitHubSyncç±»
        log('statusResult', `GitHubSyncç±»: ${typeof GitHubSync !== 'undefined' ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}`, typeof GitHubSync !== 'undefined' ? 'ok' : 'error');
        
        // æ£€æŸ¥window.githubSyncå®ä¾‹
        log('statusResult', `window.githubSync: ${window.githubSync ? 'å·²åˆ›å»º' : 'æœªåˆ›å»º'}`, window.githubSync ? 'ok' : 'error');
        
        if (window.githubSync) {
            log('statusResult', `githubSync.isConfigured(): ${window.githubSync.isConfigured()}`, window.githubSync.isConfigured() ? 'ok' : 'error');
        }
        
        // æ£€æŸ¥LiteratureManager
        log('statusResult', `LiteratureManagerç±»: ${typeof LiteratureManager !== 'undefined' ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}`, typeof LiteratureManager !== 'undefined' ? 'ok' : 'error');
        log('statusResult', `literatureManagerå®ä¾‹: ${literatureManager ? 'å·²åˆ›å»º' : 'æœªåˆ›å»º'}`, literatureManager ? 'ok' : 'warn');
        
        // æ£€æŸ¥é…ç½®çŠ¶æ€å‡½æ•°
        try {
            const status = window.getGitHubStatus();
            log('statusResult', `getGitHubStatus(): ${status.configured ? 'å·²é…ç½®' : 'æœªé…ç½®'}`, status.configured ? 'ok' : 'error');
        } catch (error) {
            log('statusResult', `getGitHubStatus() é”™è¯¯: ${error.message}`, 'error');
        }
    }
    
    async function simulateUpload() {
        clear('uploadResult');
        
        try {
            if (!window.githubSync) {
                window.githubSync = new GitHubSync();
            }
            
            if (!window.githubSync.isConfigured()) {
                log('uploadResult', 'âŒ GitHubæœªé…ç½®', 'error');
                return;
            }
            
            log('uploadResult', 'âœ… GitHubå·²é…ç½®ï¼Œå¼€å§‹æ¨¡æ‹Ÿä¸Šä¼ ...', 'ok');
            
            // åˆ›å»ºæµ‹è¯•è®ºæ–‡æ•°æ®ï¼ˆæ¨¡æ‹Ÿä¸»åº”ç”¨çš„addPaperæ–¹æ³•ï¼‰
            const testPaper = {
                id: Date.now(),
                title: "æ¨¡æ‹Ÿä¸Šä¼ æµ‹è¯•è®ºæ–‡",
                authors: ["æµ‹è¯•ä½œè€…"],
                year: 2024,
                journal: "æµ‹è¯•æœŸåˆŠ",
                researchArea: "HCI New Wearable Devices",
                methodology: "Experimental",
                studyType: "Empirical",
                keywords: ["æµ‹è¯•", "ä¸Šä¼ "],
                citations: 0,
                downloads: 0,
                abstract: "è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿä¸Šä¼ çš„æµ‹è¯•è®ºæ–‡ï¼Œç”¨äºéªŒè¯GitHubåŒæ­¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚",
                doi: "",
                websiteUrl: "#",
                pdfFileSize: 0,
                isPersistentPDF: false
            };
            
            log('uploadResult', 'æ­£åœ¨åŒæ­¥åˆ°GitHub...', 'info');
            
            // æ¨¡æ‹Ÿä¸»åº”ç”¨çš„åŒæ­¥é€»è¾‘
            await window.githubSync.syncAllData([testPaper]);
            
            log('uploadResult', 'âœ… ä¸Šä¼ æˆåŠŸï¼è¯·æ£€æŸ¥GitHubä»“åº“', 'ok');
            log('uploadResult', 'GitHubä»“åº“: https://github.com/wazgtam1/literature-data', 'info');
            
        } catch (error) {
            log('uploadResult', `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
            console.error('Simulation error:', error);
        }
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.addEventListener('load', async () => {
        // è‡ªåŠ¨å¡«å……ä¿å­˜çš„token
        const savedToken = localStorage.getItem('github_token');
        if (savedToken) {
            document.getElementById('token').value = savedToken;
            window.GITHUB_CONFIG.token = savedToken;
        }
        
        // åˆå§‹åŒ–GitHubSync
        if (typeof GitHubSync !== 'undefined' && savedToken) {
            window.githubSync = new GitHubSync();
        }
        
        // å°è¯•åˆ›å»ºLiteratureManagerå®ä¾‹ï¼ˆç”¨äºæµ‹è¯•ï¼‰
        try {
            if (typeof LiteratureManager !== 'undefined') {
                literatureManager = new LiteratureManager();
            }
        } catch (error) {
            console.log('LiteratureManager initialization failed:', error);
        }
        
        // 1ç§’åè‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        setTimeout(checkStatus, 1000);
    });
    </script>
</body>
</html>