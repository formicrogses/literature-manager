<!DOCTYPE html>
<html>
<head>
    <title>GitHubåŒæ­¥æµ‹è¯•</title>
    <script src="config.js"></script>
    <script src="github-sync.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; }
        input { padding: 8px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª GitHubåŒæ­¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div>
        <h3>æ­¥éª¤1: é…ç½®GitHub</h3>
        <p>ç”¨æˆ·å: <input type="text" id="username" value="wazgtam1"></p>
        <p>Token: <input type="password" id="token" placeholder="è¾“å…¥GitHub Token"></p>
        <button onclick="configureGitHub()">é…ç½®GitHub</button>
        <div id="configResult"></div>
    </div>
    
    <div>
        <h3>æ­¥éª¤2: æµ‹è¯•ä¸Šä¼ </h3>
        <button onclick="testUpload()">æµ‹è¯•ä¸Šä¼ papers.json</button>
        <div id="uploadResult"></div>
    </div>
    
    <div>
        <h3>æ­¥éª¤3: æµ‹è¯•PDFä¸Šä¼ </h3>
        <button onclick="testPDFUpload()">æµ‹è¯•ä¸Šä¼ PDFæ–‡ä»¶</button>
        <div id="pdfResult"></div>
    </div>
    
    <script>
    function addResult(elementId, message, type = 'info') {
        const element = document.getElementById(elementId);
        const div = document.createElement('div');
        div.className = `result ${type}`;
        div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
        element.appendChild(div);
    }
    
    function clearResults(elementId) {
        document.getElementById(elementId).innerHTML = '';
    }
    
    async function configureGitHub() {
        clearResults('configResult');
        
        const username = document.getElementById('username').value;
        const token = document.getElementById('token').value;
        
        if (!username || !token) {
            addResult('configResult', 'è¯·å¡«å†™ç”¨æˆ·åå’ŒToken', 'error');
            return;
        }
        
        try {
            // è®¾ç½®é…ç½®
            window.GITHUB_CONFIG.username = username;
            window.GITHUB_CONFIG.token = token;
            localStorage.setItem('github_username', username);
            localStorage.setItem('github_token', token);
            
            addResult('configResult', 'é…ç½®å·²ä¿å­˜åˆ°localStorage', 'success');
            
            // æµ‹è¯•è¿æ¥
            const githubSync = new GitHubSync();
            const testResult = await githubSync.testConnection();
            
            if (testResult.success) {
                addResult('configResult', `âœ… GitHubè¿æ¥æˆåŠŸ: ${testResult.message}`, 'success');
            } else {
                addResult('configResult', `âŒ GitHubè¿æ¥å¤±è´¥: ${testResult.message}`, 'error');
            }
            
        } catch (error) {
            addResult('configResult', `âŒ é…ç½®å¤±è´¥: ${error.message}`, 'error');
        }
    }
    
    async function testUpload() {
        clearResults('uploadResult');
        
        try {
            const githubSync = new GitHubSync();
            
            if (!githubSync.isConfigured()) {
                addResult('uploadResult', 'è¯·å…ˆé…ç½®GitHub', 'error');
                return;
            }
            
            addResult('uploadResult', 'æ­£åœ¨åˆ›å»ºæµ‹è¯•æ•°æ®...', 'info');
            
            // åˆ›å»ºæµ‹è¯•è®ºæ–‡æ•°æ®
            const testPapers = [
                {
                    id: 1,
                    title: "æµ‹è¯•è®ºæ–‡ï¼šæ‰‹åŠ¿è¯†åˆ«æŠ€æœ¯ç ”ç©¶",
                    authors: ["å¼ ä¸‰", "æå››"],
                    year: 2024,
                    journal: "è®¡ç®—æœºè§†è§‰å­¦æŠ¥",
                    researchArea: "HCI New Wearable Devices",
                    methodology: "Experimental",
                    studyType: "Empirical",
                    keywords: ["æ‰‹åŠ¿è¯†åˆ«", "æœºå™¨å­¦ä¹ ", "äººæœºäº¤äº’"],
                    citations: 10,
                    downloads: 150,
                    abstract: "æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºæ·±åº¦å­¦ä¹ çš„æ‰‹åŠ¿è¯†åˆ«æ–¹æ³•ï¼Œé€šè¿‡åˆ†ææ‰‹éƒ¨è¿åŠ¨è½¨è¿¹å®ç°å‡†ç¡®çš„æ‰‹åŠ¿åˆ†ç±»ã€‚å®éªŒç»“æœè¡¨æ˜è¯¥æ–¹æ³•åœ¨å‡†ç¡®ç‡å’Œå®æ—¶æ€§æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚",
                    doi: "10.1000/test.2024.001",
                    websiteUrl: "https://example.com/paper1",
                    pdfFileSize: 1024000,
                    isPersistentPDF: false
                },
                {
                    id: 2,
                    title: "æµ‹è¯•è®ºæ–‡ï¼šå¯ç©¿æˆ´è®¾å¤‡äº¤äº’è®¾è®¡",
                    authors: ["ç‹äº”", "èµµå…­"],
                    year: 2023,
                    journal: "äº¤äº’è®¾è®¡ç ”ç©¶",
                    researchArea: "Mobile Device",
                    methodology: "Survey",
                    studyType: "Theoretical",
                    keywords: ["å¯ç©¿æˆ´è®¾å¤‡", "ç”¨æˆ·ä½“éªŒ", "äº¤äº’è®¾è®¡"],
                    citations: 25,
                    downloads: 200,
                    abstract: "æœ¬ç ”ç©¶é€šè¿‡ç”¨æˆ·è°ƒç ”å’Œå®éªŒåˆ†æï¼Œæ¢è®¨äº†å¯ç©¿æˆ´è®¾å¤‡çš„äº¤äº’è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µï¼Œä¸ºæœªæ¥çš„è®¾å¤‡è®¾è®¡æä¾›äº†é‡è¦å‚è€ƒã€‚",
                    doi: "10.1000/test.2023.002",
                    websiteUrl: "https://example.com/paper2",
                    pdfFileSize: 2048000,
                    isPersistentPDF: false
                }
            ];
            
            addResult('uploadResult', `å‡†å¤‡ä¸Šä¼  ${testPapers.length} ç¯‡æµ‹è¯•è®ºæ–‡...`, 'info');
            
            // ä¸Šä¼ åˆ°GitHub
            await githubSync.syncAllData(testPapers);
            
            addResult('uploadResult', 'âœ… papers.jsonä¸Šä¼ æˆåŠŸï¼', 'success');
            addResult('uploadResult', 'è¯·æ£€æŸ¥GitHubä»“åº“: https://github.com/wazgtam1/literature-data/blob/main/papers.json', 'info');
            
        } catch (error) {
            addResult('uploadResult', `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
            console.error('Upload error:', error);
        }
    }
    
    async function testPDFUpload() {
        clearResults('pdfResult');
        
        try {
            const githubSync = new GitHubSync();
            
            if (!githubSync.isConfigured()) {
                addResult('pdfResult', 'è¯·å…ˆé…ç½®GitHub', 'error');
                return;
            }
            
            addResult('pdfResult', 'æ­£åœ¨åˆ›å»ºæµ‹è¯•PDFæ–‡ä»¶...', 'info');
            
            // åˆ›å»ºä¸€ä¸ªç®€å•çš„PDFå†…å®¹ï¼ˆæ¨¡æ‹Ÿï¼‰
            const testPDFContent = `%PDF-1.4
1 0 obj
<<
/Type /Catalog
/Pages 2 0 R
>>
endobj

2 0 obj
<<
/Type /Pages
/Kids [3 0 R]
/Count 1
>>
endobj

3 0 obj
<<
/Type /Page
/Parent 2 0 R
/MediaBox [0 0 612 792]
/Contents 4 0 R
>>
endobj

4 0 obj
<<
/Length 44
>>
stream
BT
/F1 12 Tf
100 700 Td
(Test PDF Document) Tj
ET
endstream
endobj

xref
0 5
0000000000 65535 f 
0000000009 00000 n 
0000000058 00000 n 
0000000115 00000 n 
0000000189 00000 n 
trailer
<<
/Size 5
/Root 1 0 R
>>
startxref
284
%%EOF`;
            
            // è½¬æ¢ä¸ºbase64
            const base64Content = btoa(testPDFContent);
            
            addResult('pdfResult', 'æ­£åœ¨ä¸Šä¼ æµ‹è¯•PDFåˆ°GitHub...', 'info');
            
            const result = await githubSync.uploadFile(
                'pdfs/test-paper.pdf',
                base64Content,
                'Upload test PDF file',
                true
            );
            
            addResult('pdfResult', 'âœ… PDFæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼', 'success');
            addResult('pdfResult', `æ–‡ä»¶URL: ${result.content.html_url}`, 'info');
            
        } catch (error) {
            addResult('pdfResult', `âŒ PDFä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
            console.error('PDF upload error:', error);
        }
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å¡«å…¥ä¿å­˜çš„é…ç½®
    window.addEventListener('load', () => {
        const savedToken = localStorage.getItem('github_token');
        if (savedToken) {
            document.getElementById('token').value = savedToken;
        }
    });
    </script>
</body>
</html>